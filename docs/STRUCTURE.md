# Project structure (code + runtime flow)

## High-level architecture

- **Build tool**: Vite (`vite.config.mjs` sets `base` for GitHub Pages; can be overridden by `VITE_BASE`).
- **Runtime**: React + TypeScript (Vite) with React Router for routing.
- **Rendering (3D)**: React Three Fiber (R3F) `<Canvas>` mounted inside `#darkstar-container` within the landing section.
- **Landing UI effects**:
  - Parallax: DOM layers transformed with a spring-smoothed scroll progress (bridged from React via `useEffect`).
  - Flip words: DOM text replaced/animated on a timer (bridged from React via `useEffect`).
- **Tooling**: ESLint (`eslint.config.mjs`) + Prettier (`.prettierrc.json`).

## Directory tree (source-of-truth)

```
Website3d/
  .prettierrc.json
  eslint.config.mjs
  index.html
  package.json
  vite.config.mjs
  tsconfig.json
  readme.txt
  docs/
    FILE_MAP.md
    STRUCTURE.md
  src/
    main.tsx
    App.tsx
    pages/
      Home.tsx
    components/
      TopNav.tsx
      Landing.tsx
      About.tsx
      DarkstarCanvas.tsx
    style.css
    vite-env.d.ts
    landing/
      parallax.ts
      flipWords.ts
    utils/
      mobileCheck.ts
  public/
    assets/
      DarkStar.glb
      DarkStarSmall.glb
      intro_bg.PNG
      sky.jpg
      planets.png
      mountain-1.png
      mountain-2.png
      mountain-3.png
  dist/               (generated)
  node_modules/       (generated)
```

Notes:
- `dist/` is generated by `npm run build` and is what `npm run deploy` publishes.
- `node_modules/` is generated by `npm install`.
- `src/app/SceneManager.ts` and `src/models/loadModel.ts` no longer exist (they were placeholders in an earlier iteration).

## Runtime flow (what runs on page load)

1. **`index.html` loads `src/main.tsx`**
   - `index.html` now only provides `#root` for React to mount.

2. **`src/main.tsx` mounts the React app**
   - Mounts `<App />` into `#root`.

3. **`src/App.tsx` sets up routing**
   - Uses React Router (`BrowserRouter`) with `basename={import.meta.env.BASE_URL}` for GitHub Pages base paths.
   - Current route table renders the `HomePage`.

4. **`src/pages/Home.tsx` renders the page**
   - Sets `--site-bg` using `import.meta.env.BASE_URL` so `intro_bg.PNG` resolves under a non-root base (GitHub Pages).
   - Renders:
     - `TopNav` (fixed top navigation)
     - `Landing` (parallax layers + hero + `#darkstar-container`)
     - `About` section

5. **`src/components/Landing.tsx` bootstraps landing effects + 3D**
   - Initializes:
     - `initLandingParallax(...)` (scroll + RAF driven)
     - `initFlipWords(...)` (timer driven)
   - Mounts the R3F canvas via `DarkstarCanvas` inside `#darkstar-container`.

6. **`src/components/DarkstarCanvas.tsx` renders the DarkStar scene (R3F)**
   - Lazy-loads the model when idle / near viewport.
   - Loads `public/assets/DarkStar.glb` (or `DarkStarSmall.glb` on low-power/mobile).
   - Uses a ported pointer rotation controller (from the old imperative version) to provide:
     - smoothing + clamped rotations
     - optional “lean” on fine pointers
     - scroll/wheel target recompute
   - Uses `frameloop="demand"` and invalidates while animating/input changes to reduce idle GPU usage.

3. **Per-module responsibilities**
   - **`src/components/*`**: React UI and layout.
   - **`src/components/DarkstarCanvas.tsx`**: R3F 3D scene + model loading + pointer-driven motion.
   - **`src/landing/*`**: DOM effects used by `Landing` (`parallax.ts`, `flipWords.ts`).
   - Legacy imperative Three.js modules were removed to keep the repo minimal.


